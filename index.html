<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DeepSeek Chat for Watch</title>
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Font Awesome -->
    <link href="https://cdn.jsdelivr.net/npm/font-awesome@4.7.0/css/font-awesome.min.css" rel="stylesheet">
    
    <!-- 配置Tailwind为小屏幕优化 -->
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: '#165DFF',
                        secondary: '#36D399',
                    },
                    fontFamily: {
                        sans: ['Inter', 'system-ui', 'sans-serif'],
                    },
                }
            }
        }
    </script>
    
    <style type="text/tailwindcss">
        @layer utilities {
            .content-auto {
                content-visibility: auto;
            }
            .watch-height {
                height: clamp(270px, 75vh, 330px); /* Watch屏幕高度范围 */
            }
            .watch-input {
                @apply w-full px-3 py-2 rounded-lg bg-gray-800 text-white text-sm border border-gray-700 focus:outline-none focus:ring-2 focus:ring-primary/50;
            }
            .watch-button {
                @apply px-4 py-2 bg-primary text-white rounded-lg font-medium transition-all duration-200 hover:bg-primary/90 active:scale-95 disabled:opacity-50 disabled:pointer-events-none;
            }
        }
    </style>
</head>
<body class="bg-gray-900 text-white min-h-screen font-sans">
    <div class="container mx-auto px-2 py-4 max-w-sm watch-height flex flex-col">
        <!-- 标题 -->
        <header class="mb-4 text-center">
            <h1 class="text-xl font-bold text-primary">DeepSeek Chat</h1>
        </header>
        
        <!-- 聊天区域 -->
        <div id="chat-container" class="flex-1 overflow-y-auto mb-4 bg-gray-800/50 rounded-lg p-3 space-y-3">
            <div class="flex items-start">
                <div class="bg-primary/20 p-2 rounded-lg">
                    <i class="fa fa-robot text-primary"></i>
                </div>
                <div class="ml-2 bg-gray-700/50 p-3 rounded-lg rounded-tl-none">
                    <p>你好！我是DeepSeek AI，有什么可以帮助你的？</p>
                </div>
            </div>
        </div>
        
        <!-- 输入区域 -->
        <div class="flex space-x-2">
            <input 
                type="text" 
                id="user-input" 
                placeholder="输入问题..." 
                class="watch-input flex-1"
                maxlength="200" <!-- Watch输入限制 -->
            >
            <button 
                id="send-btn" 
                class="watch-button flex items-center justify-center min-w-[40px]"
            >
                <i class="fa fa-paper-plane"></i>
            </button>
        </div>
    </div>

    <script>
        // DeepSeek API配置
        const API_KEY = "sk-4b0013d32f704409b1d467fe51a67788";
        const API_URL = "https://api.deepseek.com/v1/chat/completions";
        
        const chatContainer = document.getElementById("chat-container");
        const userInput = document.getElementById("user-input");
        const sendBtn = document.getElementById("send-btn");
        
        // 发送消息
        async function sendMessage() {
            const message = userInput.value.trim();
            if (!message) return;
            
            // 添加用户消息到聊天框
            addMessage("user", message);
            userInput.value = "";
            disableInput(true);
            
            try {
                // 显示加载状态
                const loadingId = addLoading();
                
                // 调用DeepSeek API
                const response = await fetch(API_URL, {
                    method: "POST",
                    headers: {
                        "Content-Type": "application/json",
                        "Authorization": `Bearer ${API_KEY}`
                    },
                    body: JSON.stringify({
                        model: "deepseek-chat",
                        messages: [
                            {role: "user", content: message}
                        ],
                        temperature: 0.7,
                        max_tokens: 300
                    })
                });
                
                if (!response.ok) {
                    throw new Error(`API错误: ${response.status}`);
                }
                
                const data = await response.json();
                const reply = data.choices[0].message.content;
                
                // 更新加载状态为AI回复
                updateLoading(loadingId, "ai", reply);
            } catch (error) {
                console.error("请求出错:", error);
                updateLoading(loadingId, "error", "抱歉，请求出错: " + error.message);
            } finally {
                disableInput(false);
            }
        }
        
        // 添加消息到聊天框
        function addMessage(role, content) {
            const messageClass = role === "user" ? "flex justify-end" : "flex items-start";
            const iconClass = role === "user" ? "fa-user" : "fa-robot";
            const bgClass = role === "user" ? "bg-primary/20" : "bg-gray-700/50";
            const iconColor = role === "user" ? "text-gray-300" : "text-primary";
            
            const messageHTML = `
                <div class="${messageClass}">
                    ${role === "ai" ? `
                        <div class="bg-primary/20 p-2 rounded-lg">
                            <i class="fa ${iconClass} ${iconColor}"></i>
                        </div>
                    ` : ''}
                    <div class="ml-2 ${bgClass} p-3 rounded-lg ${role === "user" ? 'rounded-tr-none' : 'rounded-tl-none'}">
                        <p>${escapeHTML(content)}</p>
                    </div>
                    ${role === "user" ? `
                        <div class="bg-gray-700/50 p-2 rounded-lg ml-1">
                            <i class="fa ${iconClass} ${iconColor}"></i>
                        </div>
                    ` : ''}
                </div>
            `;
            
            chatContainer.insertAdjacentHTML("beforeend", messageHTML);
            chatContainer.scrollTop = chatContainer.scrollHeight;
        }
        
        // 添加加载状态
        function addLoading() {
            const id = Date.now();
            const loadingHTML = `
                <div id="loading-${id}" class="flex items-start">
                    <div class="bg-primary/20 p-2 rounded-lg">
                        <i class="fa fa-robot text-primary"></i>
                    </div>
                    <div class="ml-2 bg-gray-700/50 p-3 rounded-lg rounded-tl-none">
                        <p class="text-gray-400"><i class="fa fa-circle-o-notch fa-spin mr-2"></i>思考中...</p>
                    </div>
                </div>
            `;
            
            chatContainer.insertAdjacentHTML("beforeend", loadingHTML);
            chatContainer.scrollTop = chatContainer.scrollHeight;
            return id;
        }
        
        // 更新加载状态为实际内容
        function updateLoading(id, type, content) {
            const loadingElement = document.getElementById(`loading-${id}`);
            if (!loadingElement) return;
            
            const bgClass = type === "error" ? "bg-red-900/30" : "bg-gray-700/50";
            const textClass = type === "error" ? "text-red-300" : "text-white";
            
            loadingElement.innerHTML = `
                <div class="flex items-start">
                    <div class="bg-primary/20 p-2 rounded-lg">
                        <i class="fa fa-robot text-primary"></i>
                    </div>
                    <div class="ml-2 ${bgClass} p-3 rounded-lg rounded-tl-none">
                        <p class="${textClass}">${escapeHTML(content)}</p>
                    </div>
                </div>
            `;
            
            chatContainer.scrollTop = chatContainer.scrollHeight;
        }
        
        // 禁用/启用输入
        function disableInput(disable) {
            userInput.disabled = disable;
            sendBtn.disabled = disable;
            if (disable) {
                sendBtn.classList.add("opacity-50");
            } else {
                sendBtn.classList.remove("opacity-50");
            }
        }
        
        // 转义HTML特殊字符
        function escapeHTML(str) {
            return str
                .replace(/&/g, "&amp;")
                .replace(/</g, "&lt;")
                .replace(/>/g, "&gt;")
                .replace(/"/g, "&quot;")
                .replace(/'/g, "&#039;");
        }
        
        // 事件监听
        sendBtn.addEventListener("click", sendMessage);
        userInput.addEventListener("keydown", (e) => {
            if (e.key === "Enter" && !e.shiftKey) {
                e.preventDefault();
                sendMessage();
            }
        });
        
        // 自动聚焦输入框
        userInput.focus();
    </script>
</body>
</html>
